<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="lotecs.auth.infrastructure.persistence.user.mapper.PermissionMapper">

    <!-- Permission ResultMap -->
    <resultMap id="permissionResultMap" type="lotecs.auth.domain.user.model.Permission">
        <id property="permissionId" column="PERMISSION_ID"/>
        <result property="permissionCode" column="PERMISSION_CODE"/>
        <result property="description" column="DESCRIPTION"/>
        <result property="resourceType" column="RESOURCE_TYPE"/>
        <result property="createdAt" column="CREATED_AT"/>
    </resultMap>

    <!-- ID로 권한 조회 -->
    <select id="findById" resultMap="permissionResultMap">
        SELECT
            PERMISSION_ID,
            PERMISSION_CODE,
            DESCRIPTION,
            RESOURCE_TYPE,
            CREATED_AT
        FROM AUTH_PERMISSIONS
        WHERE PERMISSION_ID = #{permissionId}
    </select>

    <!-- 권한 코드로 권한 조회 -->
    <select id="findByCode" resultMap="permissionResultMap">
        SELECT
            PERMISSION_ID,
            PERMISSION_CODE,
            DESCRIPTION,
            RESOURCE_TYPE,
            CREATED_AT
        FROM AUTH_PERMISSIONS
        WHERE PERMISSION_CODE = #{permissionCode}
    </select>

    <!-- 모든 권한 조회 -->
    <select id="findAll" resultMap="permissionResultMap">
        SELECT
            PERMISSION_ID,
            PERMISSION_CODE,
            DESCRIPTION,
            RESOURCE_TYPE,
            CREATED_AT
        FROM AUTH_PERMISSIONS
        ORDER BY PERMISSION_CODE ASC
    </select>

    <!-- 역할 ID로 권한 목록 조회 -->
    <select id="findByRoleId" resultMap="permissionResultMap">
        SELECT
            P.PERMISSION_ID,
            P.PERMISSION_CODE,
            P.DESCRIPTION,
            P.RESOURCE_TYPE,
            P.CREATED_AT
        FROM AUTH_PERMISSIONS P
        INNER JOIN AUTH_ROLE_PERMISSIONS RP ON P.PERMISSION_ID = RP.PERMISSION_ID
        WHERE RP.ROLE_ID = #{roleId}
        ORDER BY P.PERMISSION_CODE ASC
    </select>

</mapper>
